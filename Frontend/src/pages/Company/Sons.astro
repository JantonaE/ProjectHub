---
import Layout from '../../layouts/Layout.astro';
import SideBar from '../../components/SideBar.astro';
//http://127.0.0.1:8000/Companies/Portfolios/65e846ee1a79848c6df345be
const url = "http://127.0.0.1:8000";
//const { userLogged, params, mapa } = Astro.props;
const userLogged = "";
//const { idParent } = Astro.props;
const idParent = "65f09d4fadc0d6e28f9f1581";
const companyId = "65f09026adc0d6e28f9f157c";
let data;
async function getPortfoliosSons(idParent) {
    const url = "http://127.0.0.1:8000";
    try {
        const response = await fetch(`${url}/Portfolios/PortfolioSons/${idParent}`);
        
        if (response.ok) {
            return await response.json(); // Return the data
        } else {
            throw new Error('Error al obtener portfolios');
        }
    } catch (error) {
        console.error(error);
    }
}
async function getProgramSons(idParent) {
    const url = "http://127.0.0.1:8000";
    try {
        const response = await fetch(`${url}/Portfolios/ProgramSons/${idParent}`);
        
        if (response.ok) {
            return await response.json(); // Return the data
        } else {
            throw new Error('Error al obtener programas');
        }
    } catch (error) {
        console.error(error);
    }
}
async function getProjectSons(idParent) {
    const url = "http://127.0.0.1:8000";
    try {
        const response = await fetch(`${url}/Portfolios/ProjectSons/${idParent}`);
        
        if (response.ok) {
            return await response.json(); // Return the data
        } else {
            throw new Error('Error al obtener proyectos');
        }
    } catch (error) {
        console.error(error);
    }
}

  let portfolios = await getPortfoliosSons(idParent);
  let programs = await getProgramSons(idParent);
  let projects = await getProjectSons(idParent);
  
---
<div class="flex">
    <div class="w-1/5 h-full fixed inset-y-0 left-0 min-w-10">
        <SideBar />
    </div>
    <div class="w-4/5 h-full ml-64 overflow-auto text-center flex justify-center m-5">
        <table class="border-collapse border border-blue-950">
            <thead>
                <tr>
                    <th class="border p-2">Title</th>
                    <th class="border p-2">Code</th>
                    <th class="border p-2">Start Date</th>
                    <th class="border p-2">Real Start Date</th>
                    <th class="border p-2">Finish Date</th>
                    <th class="border p-2">Real Finish Date</th>
                    <th class="border p-2">Risk</th>
                    <th class="border p-2">Priority</th>
                    <th class="border p-2">Strategic Goal</th>
                </tr>
            </thead>
            <tbody>
                {portfolios && portfolios.map((portfolio) => (
                    <tr key={portfolio.idPortfolio}>
                        <td class="border p-2">{portfolio.title}</td>
                        <td class="border p-2">{portfolio.code}</td>
                        <td class="border p-2">{portfolio.start_date}</td>
                        <td class="border p-2">{portfolio.start_real_date}</td>
                        <td class="border p-2">{portfolio.finish_date}</td>
                        <td class="border p-2">{portfolio.finish_real_date}</td>
                        <td class="border p-2">{portfolio.risk}</td>
                        <td class="border p-2">{portfolio.priority}</td>
                        <td class="border p-2">{portfolio.strategic_goal}</td>
                    </tr>
                ))}
                {programs && programs.map((program) => (
                    <tr key={program.idProgram}>
                        <td class="border p-2">{program.title}</td>
                        <td class="border p-2">{program.code}</td>
                        <td class="border p-2">{program.start_date}</td>
                        <td class="border p-2">{program.start_real_date}</td>
                        <td class="border p-2">{program.finish_date}</td>
                        <td class="border p-2">{program.finish_real_date}</td>
                        <td class="border p-2">{program.risk}</td>
                        <td class="border p-2">{program.priority}</td>
                        <td class="border p-2">{program.strategic_goal}</td>
                    </tr>
                ))}
                {projects && projects.map((project) => (
                    <tr key={project.idProject}>
                        <td class="border p-2">{project.title}</td>
                        <td class="border p-2">{project.code}</td>
                        <td class="border p-2">{project.start_date}</td>
                        <td class="border p-2">{project.start_real_date}</td>
                        <td class="border p-2">{project.finish_date}</td>
                        <td class="border p-2">{project.finish_real_date}</td>
                        <td class="border p-2">{project.risk}</td>
                        <td class="border p-2">{project.priority}</td>
                        <td class="border p-2">{project.strategic_goal}</td>
                    </tr>
                ))}
            </tbody>
        </table>
    </div>
  </div>
  
  
  